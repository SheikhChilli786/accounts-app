{% load static %}{% block pageContent %}{% load customfilter %}
<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{party.name }}|transactions</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js" ></script>
    <script src="https://cdn.datatables.net/rowgroup/1.4.1/js/dataTables.rowGroup.min.js" ></script>

    <style>
       
    </style>

</head>

<body>
    <a href="javascript:history.back()" style="position: absolute; top: 20px; left: 20px; text-decoration: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 11H7.414l4.293-4.293L10 5l-6 6 6 6 1.707-1.707L7.414 13H20v-2z" fill="currentColor"/>
        </svg>
        Back
    </a>
    <h1 style="text-align:center;">تفصیل کھاتہ</h1>
  <h4 style="text-align: right;"> {{party.name}}:پارٹی</h4>
  <h4 style="text-align: right"><input name="date_to" id="date_to" type="date"></input>مورخہ  <input name="date_from" id="date_from" type="date"></input>   سے </h4>
<table id="example" class="display cell-border" style="width:100%">
        <thead>
            <tr>
                <th>بقایا</th>
                <th>بنام</th>
                <th>جمع</th>
                <th>تفصیل</th>
                <th>تاریخ</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{transaction.get_running_balance | credit_or_debit}}</td>
                <td>{{transaction.credit}}</td>
                <td>{{transaction.debit}}</td>
                <td>{{transaction.description}}</td>
                <td>{{transaction.form.created_at}}</td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% endblock pageContent %} {% block ScriptBlock %}
    <script>
        $(document).ready(function () {
            var dataTable = $('#example').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'print',
                        title:'',
                        autoPrint: false,
                        customize: function ( win ) {
                            var fromDate = $('#date_from').val();
                            var toDate = $('#date_to').val();
                            $(win.document.body).find('th:eq(0)').css('width', '90px');
                            $(win.document.body).find('th:eq(1)').css('width', '70px');
                            $(win.document.body).find('th:eq(2)').css('width', '70px');
                            $(win.document.body).find('th:eq(4)').css('width', '90px');
                            if (toDate && fromDate) {
                                $(win.document.body).prepend('<h4 style="text-align: right;"> {{party.name}}:پارٹی</h4><h4 style="text-align: right">' + toDate + 'لین دین مورخہ' + fromDate + '  سے </h4>');
                            } else if (toDate) {
                                $(win.document.body).prepend('<h4 style="text-align: right;"> {{party.name}}:پارٹی</h4><h4 style="text-align: right">' + toDate + '  پہلے لین دین سے</h4>');
                            } else if (fromDate) {
                                $(win.document.body).prepend('<h4 style="text-align: right;"> {{party.name}}:پارٹی</h4><h4 style="text-align: right"> لین دین مورخہ ' + fromDate + ' آخری لین دین تک  سے  </h4>');
                            } else {
                                $(win.document.body).prepend('<h4 style="text-align: right;"> {{party.name}}:پارٹی</h4><h4 style="text-align: right"> تمام لین دین</h4>');
                            }
                            $(win.document.body).prepend('<h1 style="text-align:center;">تفصیل کھاتہ</h1>');
                            var lastTr = $(win.document.body).find('tbody tr:last');
                            var firstTdValue = lastTr.find('td:eq(0)').text();
                    // Append a custom td just before the end of tbody and after the last tr
                            lastTr.after('<tr><td style="text-align:right; border: 1px solid #000;">'+firstTdValue+'</td></tr>');
                        }
                    }
                ],
                paging:false,
                rowGroup: {
                    dataSrc: 4
                },
                responsive: {
                    details: {
                        type: 'column',
                        target: 'tr'
                    }
                },
                columnDefs: [
                    { "width": "90px", "targets": 0 }, // Set width for the first column
                    { "width": "70px", "targets": 1 }, // Set width for the second column
                    { "width": "70px", "targets": 2 },   // Set width for the third column
                    { responsivePriority: 1, targets: 3 },
                    { responsivePriority: 2, targets: 0 },
                    {
                                orderable: false,
                                targets: [0,1,2,3,4]
                    },
                    {
                        targets: ["_all"],
                        className: 'dt-head-right'
                    },
                    {
                        targets: ["_all"],
                        className: 'dt-body-right'
                    },
                    { "type": "date", "targets": 4 }, // Treat the fourth column as a date

                ],
                order: [[4, 'asc']],
            } );
        var date_to = $('#date_to');
        var date_from = $('#date_from');
        
        date_to.on('change', function () {
            dataTable.draw();
        });

        date_from.on('change', function () {
            dataTable.draw();
        });
        var hideColumnIndex = -1;
        var column = dataTable.column(hideColumnIndex);
        column.visible(false);
        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {

                var minDate = date_from.val() ? new Date(date_from.val()) : null;
                var maxDate = date_to.val() ? new Date(date_to.val()) : null;
                var transactionDate = new Date(data[4]); // assuming the date is in the 5th column
                console.log(minDate,maxDate,transactionDate>=minDate)

                if (
                    (minDate === null || transactionDate.setHours(0, 0, 0, 0) >= minDate.setHours(0, 0, 0, 0)) &&
                    (maxDate === null || transactionDate.setHours(0, 0, 0, 0) <= maxDate.setHours(0, 0, 0, 0))
                ) {
                    return true;
                }

                return false;
            }
        );

        })
            
    
    </script>

    {% endblock ScriptBlock %}
</body>

</html>
